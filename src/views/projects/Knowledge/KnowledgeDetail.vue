<template>
  <div class="container-fluid mt-4">
    <div class="row" style="max-width: 1200px; margin: 0 auto;">
      <!-- ‚úÖ ÏôºÏ™Ω: ÌÅ∞ Ïπ¥Îìú (Ìï≠ÏÉÅ Í∞ÄÎ°ú Î∞∞Ïπò) -->
      <div class="col-7">
        <!-- ‚úÖ col-md-7 ‚Üí col-7Î°ú Î≥ÄÍ≤Ω (Ìï≠ÏÉÅ 7Ïπ∏ Ï∞®ÏßÄ) -->
        <div class="card" style="height: 100%;">
          <div class="card-body" style="padding: 2rem;">

            <!-- Ï†úÎ™© -->
            <h5 class="card-title mb-3" style="font-size: 1.5rem; font-weight: bold;">
              {{ knowledge.knowledgeTitle }}
            </h5>

            <!-- ÎÇ¥Ïö© -->
            <div class="mb-3">
              <p class="card-text" style="white-space: pre-wrap; line-height: 1.6;">
                {{ knowledge.knowledgeContent }}
              </p>
            </div>

            <!-- URL -->
            <div class="mb-3" v-if="knowledge.knowledgeUrl">
              <div class="d-flex align-items-center">
                <LinkIcon class="need-icon" />
                <span style="font-weight: 500; margin-right: 8px;"> URL</span>
                <a :href="knowledge.knowledgeUrl" target="_blank" class="text-decoration-none" style="color: #0066cc; word-break: break-all;">
                  {{ knowledge.knowledgeUrl }}
                </a>
              </div>
            </div>

            <!-- Ïù¥ÎØ∏ÏßÄ -->
            <div class="mb-3" v-if="kfAttach != null">
              <img :src="kfAttach" alt="Ï≤®Î∂Ä Ïù¥ÎØ∏ÏßÄ" style="width: 100%; height: auto; border-radius: 8px; object-fit: cover; max-height: 400px;" />
            </div>

            <hr style="margin: 1.5rem 0; border-color: #e0e0e0;">


            <!--ÎåìÍ∏Ä ÏòÅÏó≠ -->

            <div class="mb-4">
              <h6 class="mb-3" style="font-weight: bold; font-size: 1.1rem;">
                ÎåìÍ∏Ä Í∞úÏàò: {{ knowledgeCommentList.length }}
              </h6>

              <!-- ÎåìÍ∏Ä Î™©Î°ù-->
              <div v-if="knowledgeCommentList.length > 0" class="mb-4">
                <div v-for="comment in knowledgeCommentList" :key="comment.knowledgeCommentId" class="comment-item p-3 mb-3"
                  style="background-color: #f8f9fa; border-radius: 8px; border-left: 3px solid #6c757d;">

                  <!-- ÎåìÍ∏Ä Ìó§Îçî (ÏûëÏÑ±Ïûê, ÎÇ†Ïßú)-->
                  <div class="d-flex justify-content-between align-items-center mb-2">
                    <div class="d-flex align-items-center gap-2">
                      <!-- ÏûëÏÑ±Ïûê ÏïÑÏù¥ÏΩò
                      <div
                        style="width: 32px; height: 32px; background-color: #6c757d; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">
                        {{ comment.userId ? comment.userId.substring(0, 1).toUpperCase() : 'U' }}
                      </div>
-->
                      <!-- ÏûëÏÑ±Ïûê ÏïÑÏù¥Îîî-->
                      <span style="font-weight: 500; font-size: 0.95rem;">
                        {{ 'ÏÇ¨Ïö©Ïûê' + comment.userId }}
                      </span>
                      <!-- ÏûëÏÑ±Ïûê ÌëúÏãú-->
                      <span v-if="comment.userId === knowledge.userId" class="badge bg-primary" style="font-size: 0.7rem;">
                        ÏûëÏÑ±Ïûê
                      </span>
                    </div>

                    <!-- ÏûëÏÑ± ÎÇ†Ïßú-->
                    <span style="font-size: 0.85rem; color: #6c757d;">
                      {{ formatDate(comment.knowledgeCommentCreatedAt) }}
                    </span>
                  </div>

                  <!--ÎåìÍ∏Ä ÎÇ¥Ïö©-->
                  <div style="padding-left: 40px;">
                    <!--ÏùºÎ∞ò Î™®Îìú -->
                    <p v-if="editingKnowledgeCommentId !== comment.knowledgeCommentId" style="margin: 0; white-space: pre-wrap; line-height: 1.6; color: #333;">
                      {{ comment.knowledgeCommentContent }}
                    </p>
                    <!-- ÏàòÏ†ï Î™®Îìú -->
                    <div v-else>
                      <textarea v-model="editingKnowledgeCommentContent" class="form-control mb-2" style="width: 100%; height: 100px; resize: none;" placeholder="ÎåìÍ∏ÄÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî...">

                      </textarea>

                    </div>

                  </div>

                  <!--ÎåìÍ∏Ä ÏàòÏ†ï/ ÏÇ≠Ï†ú Î≥∏Ïù∏ ÎåìÍ∏ÄÎßå-->
                  <div v-if="store.state.userId === comment.userId" class="d-flex gap-2 mt-2" style="padding-left: 40px;">
                    <!-- ÏùºÎ∞ò Î™®Îìú Î≤ÑÌäº -->
                    <button v-if="editingKnowledgeCommentId !== comment.knowledgeCommentId" class="btn btn-sm btn-outline-secondary" style="font-size: 0.8rem;" @click="updateStart(comment)">
                      ÏàòÏ†ï
                    </button>
                    <button v-if="editingKnowledgeCommentId !== comment.knowledgeCommentId" class="btn btn-sm btn-outline-danger" style="font-size: 0.8rem;"
                      @click="deleteKnowledgeComment(comment.knowledgeCommentId)">
                      ÏÇ≠Ï†ú
                    </button>

                    <!-- ÏàòÏ†ï Î™®Îìú Î≤ÑÌäº -->
                    <button v-if="editingKnowledgeCommentId === comment.knowledgeCommentId" class="btn btn-sm btn-primary" style="font-size: 0.8rem;" @click="updateKnowledgeComment">
                      ÏàòÏ†ï ÏôÑÎ£å
                    </button>
                    <button v-if="editingKnowledgeCommentId === comment.knowledgeCommentId" class="btn btn-sm btn-secondary" style="font-size: 0.8rem;" @click="cancelUpdateKnowledgeComment">
                    Ï∑®ÏÜå
                    </button>

                  </div>

                </div>
              </div>
              <!-- ÎåìÍ∏ÄÏù¥ ÏóÜÏùÑÎïå -->
              <div v-else class="text-center p-4" style="background-color: #f8f9fa; border-radius: 8px;">
                <p style="color: #6c757d; margin: 0;">Ï≤´ Î≤àÏß∏ ÎåìÍ∏ÄÏùÑ ÏûëÏÑ±Ìï¥Î≥¥ÏÑ∏Ïöî! üí¨</p>
              </div>

              <!--ÎåìÍ∏Ä ÏûëÏÑ± ÏòÅÏó≠ -->

              <div class="mb-4">
                <label for="knowledgeCommentContent" class="form-label">ÎåìÍ∏Ä</label>
                <textarea class="form-control" style="width: 100%; height: 120px; resize: none;" rows="3" placeholder="ÎåìÍ∏ÄÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî..." v-model="knowledgeComment.knowledgeCommentContent">
                  </textarea>
                <div class="d-flex justify-content-end">
                  <button class="btn btn-dark btn-sm mt-2" @click="createComment">Îì±Î°ù</button>

                </div>
              </div>



            </div>

            <!-- ‚úÖ Ïù¥Ï†Ñ/Îã§Ïùå Í∏Ä ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò -->
            <div class="d-flex justify-content-between align-items-center mb-3">
              <!-- Ïù¥Ï†Ñ Í∏Ä -->
              <div style="flex: 1;">
                <RouterLink v-if="prevKnowledge" :to="`/project/${projectId}/KnowledgeDetail?knowledgeId=${prevKnowledge.knowledgeId}`" class="text-decoration-none" style="color: #333;">
                  <div class="d-flex align-items-center">
                    <ArrowLeftCircleIcon class="need-icon" />
                    <div>
                      <div style="font-size: 0.75rem; color: #999;">Ïù¥Ï†Ñ Í∏Ä</div>
                      <div style="font-size: 0.9rem; font-weight: 500;">{{ prevKnowledge.knowledgeTitle }}</div>
                    </div>
                  </div>
                </RouterLink>
                <div v-else style="color: #ccc;">
                  <div style="font-size: 0.75rem;">Ïù¥Ï†Ñ Í∏Ä</div>
                  <div style="font-size: 0.9rem;">Ïù¥Ï†Ñ Í∏ÄÏù¥ ÏóÜÏäµÎãàÎã§</div>
                </div>
              </div>


              <!-- Îã§Ïùå Í∏Ä -->
              <div style="flex: 1; text-align: right;">
                <RouterLink v-if="nextKnowledge" :to="`/project/${projectId}/KnowledgeDetail?knowledgeId=${nextKnowledge.knowledgeId}`" class="text-decoration-none" style="color: #333;">
                  <div class="d-flex align-items-center justify-content-end">
                    <div>
                      <div style="font-size: 0.75rem; color: #999;">Îã§Ïùå Í∏Ä</div>
                      <div style="font-size: 0.9rem; font-weight: 500;">{{ nextKnowledge.knowledgeTitle }}</div>
                    </div>
                    <ArrowRightCircleIcon class="need-icon" />
                  </div>
                </RouterLink>

              </div>
            </div>



            <!-- Î≤ÑÌäº -->
            <div class="d-flex justify-content-end gap-2">
              <button class="btn btn-outline-dark btn-sm" @click="moveKnowledgeList">
                Î™©Î°ù
              </button>

              <span v-if="store.state.userId == knowledge.userId">
                <button class="btn btn-dark btn-sm me-1" @click="updateKnowledge">
                  ÏàòÏ†ï
                </button>
                <button class="btn btn-danger btn-sm" @click="deleteKnowledge">
                  ÏÇ≠Ï†ú
                </button>
              </span>
            </div>
          </div>
        </div>
      </div>

      <!-- ‚úÖ Ïò§Î•∏Ï™Ω: ÏûëÏùÄ Ïπ¥Îìú 3Í∞ú (Ìï≠ÏÉÅ Í∞ÄÎ°ú Î∞∞Ïπò) -->
      <div class="col-5">
        <!-- ‚úÖ col-md-5 ‚Üí col-5Î°ú Î≥ÄÍ≤Ω (Ìï≠ÏÉÅ 5Ïπ∏ Ï∞®ÏßÄ) -->
        <h4>
          <SparklesIcon class="need-icon" />Ïù¥Îü∞ Ï£ºÏ†úÎäî Ïñ¥Îñ†Ïã†Í∞ÄÏöî?
        </h4>
        <span class="p-2 mb-5">Îì±Î°ùÎêú ÌÉúÍ∑∏ÏôÄ Í¥ÄÎ†®ÏûàÎäî Í∏ÄÏùÑ Ï∂îÏ≤úÌï¥ÎìúÎ¶ΩÎãàÎã§.</span>
        <!-- Ï≤´ Î≤àÏß∏ ÏûëÏùÄ Ïπ¥Îìú -->
        <div class="card mb-3 mt-3" style="border: 1px solid #e0e0e0;">
          <div class="card-body p-3">
            <div class="d-flex align-items-center gap-3">
              <!-- Ïç∏ÎÑ§Ïùº Ïù¥ÎØ∏ÏßÄ -->
              <div style="flex-shrink: 0;">
                <div style="width: 100px; height: 100px; background-color: #8b9196; border-radius: 4px; display: flex; align-items: center; justify-content: center; color: white;">
                  Ïù¥ÎØ∏ÏßÄ
                </div>
              </div>
              <!-- ÌÖçÏä§Ìä∏ -->
              <div style="flex: 1;">
                <p class="mb-0" style="font-size: 0.9rem; color: #666;">#ÌîÑÎ°úÏ†ùÌä∏ Ï£ºÏ†ú</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Îëê Î≤àÏß∏ ÏûëÏùÄ Ïπ¥Îìú -->
        <div class="card mb-3" style="border: 1px solid #e0e0e0;">
          <div class="card-body p-3">
            <div class="d-flex align-items-center gap-3">
              <div style="flex-shrink: 0;">
                <div style="width: 100px; height: 100px; background-color: #8b9196; border-radius: 4px; display: flex; align-items: center; justify-content: center; color: white;">
                  Ïù¥ÎØ∏ÏßÄ
                </div>
              </div>
              <div style="flex: 1;">
                <p class="mb-0" style="font-size: 0.9rem; color: #666;">#ÌîÑÎ°úÏ†ùÌä∏ Ï£ºÏ†ú</p>
              </div>
            </div>
          </div>
        </div>

        <!-- ÏÑ∏ Î≤àÏß∏ ÏûëÏùÄ Ïπ¥Îìú -->
        <div class="card mb-3" style="border: 1px solid #e0e0e0;">
          <div class="card-body p-3">
            <div class="d-flex align-items-center gap-3">
              <div style="flex-shrink: 0;">
                <div style="width: 100px; height: 100px; background-color: #8b9196; border-radius: 4px; display: flex; align-items: center; justify-content: center; color: white;">
                  Ïù¥ÎØ∏ÏßÄ
                </div>
              </div>
              <div style="flex: 1;">
                <p class="mb-0" style="font-size: 0.9rem; color: #666;">#ÌîÑÎ°úÏ†ùÌä∏ Ï£ºÏ†ú</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>


    <div class="modal fade" id="fadeModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="fadeModal"> ÎåìÍ∏Ä Îì±Î°ù ÏÑ±Í≥µ</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <CheckBadgeIcon class="need-icon" />
            {{ modalMessage }}
          </div>

        </div>
      </div>
    </div>

  </div>
</template>


<!--Ïª¥Ìè¨ÎÑåÌä∏Ïùò Ï¥àÍ∏∞Ìôî ÎòêÎäî Ïù¥Î≤§Ìä∏ Ï≤òÎ¶¨-->
<script setup>
import knowledgeApi from '@/apis/knowledgeApi';
import knowledgeCommentApi from '@/apis/knowledgeCommentApi';
import { ArrowLeftCircleIcon, ArrowRightCircleIcon, CheckBadgeIcon, LinkIcon, SparklesIcon } from '@heroicons/vue/24/outline';
import { ref, watch } from 'vue';
import { RouterLink, useRoute, useRouter } from 'vue-router';
import { useStore } from 'vuex';
import * as bootstrap from 'bootstrap';

const props = defineProps(['projectId']);

const store = useStore();
const route = useRoute();
const router = useRouter();
const knowledgeId = route.query.knowledgeId;
const prevKnowledge = ref(null);
const nextKnowledge = ref(null);
const modalMessage = ref('');

const knowledge = ref({
  knowledgeId: "",
  knowledgeTitle: "",
  knowledgeContent: "",
  knowledgeUrl: "",
  kfAttachoname: "",
  kfAttachtype: "",
  userId: "",
  projectId: ""

})
//ÏûÖÎ†•Ïö©
const knowledgeComment = ref({
  knowledgeId: "",
  userId: "",
  knowledgeCommentContent: ""
});

//Î™©Î°ùÏö©
const knowledgeCommentList = ref([]);

const kfAttach = ref(null);

//ÏàòÏ†ïÏö© ÏÉÅÌÉú Í∞ùÏ≤¥
const isEditMode = ref(false);

const editingKnowledgeCommentId = ref(null);
const editingKnowledgeCommentContent = ref('');



//Î∞±ÏóîÎìúÏóêÏÑú Í≤åÏãúÎ¨º Í∞ÄÏ†∏Ïò§Í∏∞
async function getKnowledge(knowledgeId) {
  try {
    const response = await knowledgeApi.knowledgeDetail(knowledgeId);
    console.log('ÏöîÏ≤≠ URL:', response.data);

    if (response.data.result === 'success') {
      knowledge.value = response.data.data;
      console.log(knowledge.value);
      console.log(knowledge.value.userId);

      prevKnowledge.value = response.data.prevKnowledge;
      nextKnowledge.value = response.data.nextKnowledge;

      console.log(prevKnowledge.value);
      console.log(nextKnowledge.value);

      kfAttach.value = null;

      if (knowledge.value.kfAttachoname != null) {
        knowledgeAttachDownload(knowledgeId);
      }
      console.log("ÏßÄÏãùÏ∞ΩÍ≥† Í∞úÎ≥Ñ getKnowledge Í≤åÏãúÎ¨º Í∞ÄÏ†∏Ïò§Í∏∞ ÏÑ±Í≥µ");
    } else {
      console.log("ÏßÄÏãù Ï∞ΩÍ≥† Í∞úÎ≥Ñ ÌéòÏù¥ÏßÄ Ï°∞Ìöå Ïã§Ìå®");
    }

  } catch (error) {
    console.log(error);
  }

}

/*
   Î°úÍ∑∏Ïù∏ Ï≤òÎ¶¨ÌïòÎ©¥ ÏóÜÏï® ÏûÑÏãú ÏΩîÎìú
*/
getKnowledge(knowledgeId);



async function knowledgeAttachDownload(knowledgeId) {
  try {
    const response = await knowledgeApi.knowledgeAttachDownload(knowledgeId);
    const blob = response.data;
    kfAttach.value = URL.createObjectURL(blob);
    console.log('knowlegeÏ≤®Î∂ÄÌååÏùºÌôïÏù∏Ïö©: ', kfAttach.value);
  } catch (error) {
    console.log(error);
  }
}

watch(() => route.query.knowledgeId, (newKnowledgeId, oldKnowledgeId) => {
  getKnowledge(newKnowledgeId);
},
  {
    immediate: true  // Ïª¥Ìè¨ÎÑåÌä∏ ÎßàÏö¥Ìä∏ Ïãú Ï¶âÏãú Ïã§Ìñâ
  }
)

// getKnowledge(knowledgeId);
getKnowledgeCommentList(knowledgeId);

/*
  Ïó¨Í∏∞ Î∂ÄÌÑ∞ ÎåìÍ∏Ä Í≤åÏãúÌåê Í¥ÄÎ†® function ‚ñº
*/

//ÎåìÍ∏Ä Í≤åÏãúÌåê Í∏ÄÏì∞Í∏∞
async function createComment() {

  try {

    knowledgeComment.value.knowledgeId = knowledgeId;
    knowledgeComment.value.userId = store.state.userId;

    const data = structuredClone(knowledgeComment.value);
    console.log(data);

    const response = await knowledgeCommentApi.knowledgeCommentCreate(data);
    console.log("responseÏùò Í∞í", response.data);

    if (response.data !== null) {
      knowledgeComment.value.knowledgeCommentContent = "";

      showModal('ÎåìÍ∏Ä Îì±Î°ùÏóê ÏÑ±Í≥µÌñàÏäµÎãàÎã§.');
    }
    await getKnowledgeCommentList(knowledgeId);

  } catch (error) {
    console.log(error);
    showModal('ÎåìÍ∏Ä Îì±Î°ùÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
  }

}

//ÎåìÍ∏Ä Î™©Î°ù
async function getKnowledgeCommentList(knowledgeId) {
  try {
    console.log("ÎåìÍ∏Ä Î™©Î°ù Í∞ÄÏ†∏Ïò§Í∏∞ ÎèÑÏ†Ñ: ", knowledgeId);
    const response = await knowledgeCommentApi.knowledgeCommentList(knowledgeId);
    //Ï†ÑÏ≤¥ ÏùëÎãµ
    console.log("ÏùëÎãµ Ï†ÑÏ≤¥:", response.data);
    if (response.data.result === 'success') {
      // Î∞±ÏóîÎìúÍ∞Ä commentListÎ°ú Î≥¥ÎÉÑ
      knowledgeCommentList.value = response.data.commentList;

      console.log("ÎåìÍ∏Ä Ï°∞Ìöå ÏÑ±Í≥µ");
      console.log("ÎåìÍ∏Ä Í∞úÏàò:", knowledgeCommentList.value.length);
      console.log("ÎåìÍ∏Ä Îç∞Ïù¥ÌÑ∞:", knowledgeCommentList.value);
    } else {
      knowledgeCommentList.value = [];
    }

  } catch (error) {
    console.error("ÎåìÍ∏Ä Ï°∞Ìöå ÏóêÎü¨:", error);
    if (error.response) {
      console.error("ÏÑúÎ≤Ñ ÏùëÎãµ:", error.response.data);
      console.error("ÏÉÅÌÉú ÏΩîÎìú:", error.response.status);
    }
    knowledgeCommentList.value = [];
  }
}

// ÎÇ†Ïßú Ìè¨Îß∑ Ìï®Ïàò
function formatDate(dateString) {
  if (!dateString) return '';

  const date = new Date(dateString);
  const now = new Date();
  const diff = now - date;

  // 1Î∂Ñ ÎØ∏Îßå
  if (diff < 60000) return 'Î∞©Í∏à Ï†Ñ';
  // 1ÏãúÍ∞Ñ ÎØ∏Îßå
  if (diff < 3600000) return Math.floor(diff / 60000) + 'Î∂Ñ Ï†Ñ';
  // 24ÏãúÍ∞Ñ ÎØ∏Îßå
  if (diff < 86400000) return Math.floor(diff / 3600000) + 'ÏãúÍ∞Ñ Ï†Ñ';
  // 7Ïùº ÎØ∏Îßå
  if (diff < 604800000) return Math.floor(diff / 86400000) + 'Ïùº Ï†Ñ';

  // Í∑∏ Ïô∏: ÎÇ†Ïßú ÌëúÏãú
  const year = date.getFullYear();
  const month = String(date.getMonth() + 1).padStart(2, '0');
  const day = String(date.getDate()).padStart(2, '0');

  return `${year}.${month}.${day}`;
}

/*
  ÎÇ¥Í∞Ä Ïì¥ ÎåìÍ∏Ä ÏàòÏ†ïÌïòÍ∏∞
  ÏÉÅÌÉú Í∞ùÏ≤¥ÎèÑ ÎåìÍ∏Ä ÎßåÎìúÎäîÍ±∞Îûë ÏàòÏ†ïÏö© ÏÉÅÌÉúÍ∞ùÏ≤¥Î°ú ÎÇòÎà†ÏïºÌï®
  Í∞ôÏùÄ ÌôîÎ©¥ÏóêÏÑú Ìï®Ïàò Ïù¥ÎèôÌïòÍ∏∞
  ÏàòÏ†ï Î≤ÑÌäº ÎàåÎ†ÄÏùÑÎïå ÏàòÏ†ï ÏãúÏûë updateStart-> ÏàòÏ†ïÎêú ÎÇ¥Ïö©ÏùÑ Î≥¥ÎÇº Ìï®ÏàòupdateKnowledgeComment

//ÏàòÏ†ïÏö© ÏÉÅÌÉú Í∞ùÏ≤¥
const isEditMode = ref(false);
// ÏàòÏ†ï Î™®Îìú Í¥ÄÎ¶¨Ïö© ref (Í∞ÅÍ∞Å Î∂ÑÎ¶¨)
const editingKnowledgeCommentId = ref(null);
const editingKnowledgeCommentContent = ref('');


  ÏÇ≠Ï†ú Î≤ÑÌäº ÎàåÎ†ÄÏùÑÎïå ÏÇ≠Ï†ú ÌôïÏù∏Ïö© Î™®Îã¨-> ÌôïÏù∏ ÎàÑÎ•¥Î©¥ ÏÇ≠Ï†úÌï®Ïàò Î∞±ÏóîÎìúÎ°ú Î≥¥ÎÇ∏Îã§.
*/
function updateStart(comment) {
  console.log("ÏàòÏ†ïÎ™®Îìú -ÎåìÍ∏Ä ÏãúÏûë", comment);

  isEditMode.value = true;
  editingKnowledgeCommentId.value = comment.knowledgeCommentId;
  editingKnowledgeCommentContent.value = comment.knowledgeCommentContent;

  console.log("ÏàòÏ†ïÌï† ÎåìÍ∏Ä ID:", editingKnowledgeCommentId.value);
  console.log("ÏàòÏ†ïÌï† ÎÇ¥Ïö©:", editingKnowledgeCommentContent.value);


}

//ÏàòÏ†ï Ï∑®ÏÜå
function cancelUpdateKnowledgeComment() {
  isEditMode.value = false;
  editingKnowledgeCommentId.value = null;
  editingKnowledgeCommentContent.value = '';
}


async function updateKnowledgeComment() {
  try {
    console.log("ÎåìÍ∏Ä ÏàòÏ†ïÌïòÎü¨ Í∞ÄÏûê");

    if (!editingKnowledgeCommentContent.value.trim()) {
      showModal('ÏàòÏ†ïÌï† ÎÇ¥Ïö©ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî');
      return;
    }


    const data = {
      knowledgeCommentId: editingKnowledgeCommentId.value,
      knowledgeId: knowledgeId,
      userId: store.state.userId,
      knowledgeCommentContent: editingKnowledgeCommentContent.value
    }

    console.log('Ï†ÑÏÜ°Ìï† Îç∞Ïù¥ÌÑ∞', data);


    const response = await knowledgeCommentApi.knowledgeCommentUpdate(data);
    console.log("Î∞±ÏóîÎìúÏùò ÏàòÏ†ïÏùëÎãµ", response.data);

    if (response.data !== null) {
      showModal('ÎåìÍ∏Ä ÏàòÏ†ïÏù¥ ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§');
      //ÏàòÏ†ï Î™®Îìú Ï¢ÖÎ£å
      cancelUpdateKnowledgeComment();
      await getKnowledgeCommentList(knowledgeId);
    }


  } catch (error) {
    console.log(error);
    showModal('ÎåìÍ∏Ä ÏàòÏ†ïÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
  }

}

async function deleteKnowledgeComment(knowledgeCommentId) {
  //ÏÇ≠Ï†úÌïòÍ∏∞ 
  //ÏÇ≠Ï†ú Î≤ÑÌäº ÎàåÎ†ÄÏùÑÎïå ÏÇ≠Ï†ú ÌôïÏù∏Ïö© Î™®Îã¨-> ÌôïÏù∏ ÎàÑÎ•¥Î©¥ ÏÇ≠Ï†úÌï®Ïàò Î∞±ÏóîÎìúÎ°ú Î≥¥ÎÇ∏Îã§.



  try {
    const response = await knowledgeCommentApi.knowledgeCommentDelete(knowledgeCommentId);

    console.log('ÏÇ≠Ï†ú ÏöîÏ≤≠ Í≤∞Í≥º', response.data);
    showModal('ÎåìÍ∏ÄÏù¥ ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.');
    await getKnowledgeCommentList(knowledgeId);
  } catch (error) {
    console.log(error);
    showModal('ÎåìÍ∏Ä ÏÇ≠Ï†úÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
  }


}


//Î™®Îã¨Ï∞Ω ÎßåÎì§Í∏∞

function showModal(message) {
  modalMessage.value = message;
  const modalElement = document.getElementById('fadeModal');
  const modal = new bootstrap.Modal(modalElement);
  modal.show();
}


//Ïó¨Í∏∞ÏóêÏÑú router.push( ) updateÎ°ú Í∞ÄÎäî ÏøºÎ¶¨Î¨∏/ knowledgeIdÍ∞Ä ÎÑòÏñ¥Í∞àÍ±∞Îã§.
function moveKnowledgeList() {
  router.push("KnowledgeList");
}

function updateKnowledge() {
  router.push(`/project/${props.projectId}/KnowledgeUpdate?knowledgeId=${knowledgeId}`);
}

async function deleteKnowledge() {
  try {
    const response = await knowledgeApi.knowledgeDelete(knowledgeId);
    if (response.data.result === "success") {
      router.back();
    }

  } catch (error) {
    console.log(error);
  }
}
</script>

<style scoped>
.card {
  box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);

}

.card-title {
  color: #333;
}

.card-text {
  color: #555;
  font-size: 0.95rem;
}

.btn {
  min-width: 70px;

}


.need-icon {
  width: 24px;
  height: 24px;
}

.comment-item {
  transition: all 0.2s ease;
}

.comment-item:hover {
  background-color: #e9ecef !important;
  transform: translateX(2px);
}
</style>